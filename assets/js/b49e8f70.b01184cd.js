"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5072],{7514:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>h,contentTitle:()=>c,default:()=>g,frontMatter:()=>o,metadata:()=>d,toc:()=>p});var n=s(4848),r=s(8453),l=s(6540);const t=e=>{let{question:i,options:s,correctIndex:r,feedback:t}=e;const[a,o]=(0,l.useState)(null),[c,d]=(0,l.useState)(!1);return(0,n.jsxs)("div",{style:{border:"2px solid var(--ifm-color-primary)",borderRadius:"10px",padding:"24px",margin:"24px 0",backgroundColor:"var(--ifm-background-color)",boxShadow:"0 2px 8px rgba(0,0,0,0.04)"},children:[(0,n.jsx)("p",{style:{color:"var(--ifm-font-color-base)"},children:(0,n.jsx)("strong",{children:i})}),(0,n.jsx)("ul",{style:{listStyleType:"none",padding:0},children:s.map(((e,i)=>(0,n.jsx)("li",{onClick:()=>(o(i),void d(!0)),style:{cursor:"pointer",margin:"6px 0",padding:"6px",border:a===i?"2px solid var(--ifm-color-primary)":"1px solid var(--ifm-color-emphasis-300)",borderRadius:"4px"},children:e},i)))}),c&&(0,n.jsx)("p",{style:{color:a===r?"var(--ifm-color-success)":"var(--ifm-color-danger)"},children:t[a]})]})};var a=s(1432);const o={},c="SQL Query Optimization",d={id:"blog/25-10-05-Database",title:"SQL Query Optimization",description:"<MultipleChoice",source:"@site/docs/blog/25-10-05-Database.mdx",sourceDirName:"blog",slug:"/blog/25-10-05-Database",permalink:"/docs/blog/25-10-05-Database",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Blog",permalink:"/docs/category/blog"},next:{title:"Fundamental Knowledge",permalink:"/docs/category/fundamental-knowledge"}},h={},p=[{value:"What is QUERY OPTIMIZER ?",id:"what-is-query-optimizer-",level:2},{value:"Logical plan",id:"logical-plan",level:3},{value:"Physical plan",id:"physical-plan",level:3},{value:"Queries examples with plans",id:"queries-examples-with-plans",level:2},{value:"How we know which plan is better",id:"how-we-know-which-plan-is-better",level:2},{value:"Reference",id:"reference",level:2}];function m(e){const i={a:"a",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{Details:l}=i;return l||function(e,i){throw new Error("Expected "+(i?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.header,{children:(0,n.jsx)(i.h1,{id:"sql-query-optimization",children:"SQL Query Optimization"})}),"\n",(0,n.jsx)("div",{id:"first-question",children:(0,n.jsx)(t,{question:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.p,{children:"With Pre-conditions below, which plan is more efficient for query in the image?"}),(0,n.jsxs)(i.ul,{children:[(0,n.jsx)(i.li,{children:"1. Table Reviews have 100.000 pages with 100 rows/page, totals 10.000.000 records (800MB). Sorted on date"}),(0,n.jsx)(i.li,{children:"2. Time Sequential disk I/O = 100MB/second"}),(0,n.jsx)(i.li,{children:"3. Time Random disk I/O = 0.003 second per disk I/O"}),(0,n.jsx)(i.li,{children:"4. CPU time = 0.1 \u03bcs (10^-6s)/row for `FILTER predicate`"}),(0,n.jsx)(i.li,{children:"5. CPU time = 0.1 \u03bcs (10^-6s)/row for `AVG predicate`"}),(0,n.jsx)(i.li,{children:"6. 100 rows are estimated to satisfy the predicate"})]}),(0,n.jsx)(a.A,{language:"sql",children:"SELECT AVG(RATING) FROM Reviews WHERE MID = 932;"}),(0,n.jsx)(i.img,{src:"/img/question/img_1.png",alt:"Query Optimizer Diagram",style:{maxWidth:"60%",height:"auto"}})]}),options:["Plan #1","Plan #2"],correctIndex:1,feedback:["Read this blog to know why Plan #2 is better","Correct! But plan #1 can be better WHEN  more than 10.000 rows that satisfy the predicate (100 rows is given in pre-condition 6)"]})}),"\n",(0,n.jsx)(i.h2,{id:"what-is-query-optimizer-",children:"What is QUERY OPTIMIZER ?"}),"\n",(0,n.jsxs)(i.p,{children:["SQL statement -> ",(0,n.jsx)(i.strong,{children:"QUERY OPTIMIZER"})," -> Awesome plan"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"QUERY OPTIMIZER transfer SQL queries into an efficient execution plan, one logical plan can have multiple physical plans."}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"logical-plan",children:"Logical plan"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)("span",{className:"layered-style",children:"What"})," they do, e.g: union, selection, join, project."]}),"\n",(0,n.jsx)(i.h3,{id:"physical-plan",children:"Physical plan"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)("span",{className:"layered-style",children:"How"})," they do, e.g: nested loop join, merge join, hash join."]}),"\n",(0,n.jsx)(i.h2,{id:"queries-examples-with-plans",children:"Queries examples with plans"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"img.png",src:s(9024).A+"",width:"760",height:"578"})}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"img.png",src:s(2784).A+"",width:"764",height:"577"})}),"\n",(0,n.jsx)(i.h2,{id:"how-we-know-which-plan-is-better",children:"How we know which plan is better"}),"\n",(0,n.jsxs)(i.p,{children:["We need to ",(0,n.jsx)("span",{className:"layered-style",children:"ESTIMATE COSTS"})," to choose plan. Two key costs that QO considers:"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)("span",{className:"layered-style",children:"I/O costs"}),": reading page from storage"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)("span",{className:"layered-style",children:"CPU costs"}),": applying predicate on tuples in memory"]}),"\n"]}),"\n",(0,n.jsxs)(i.p,{children:["Now you can back to the ",(0,n.jsx)(i.a,{href:"#first-question",children:"first question"})," and try to calculate the cost of each plan."]}),"\n",(0,n.jsxs)(l,{children:[(0,n.jsx)("summary",{children:"Plan #1"}),(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"img.png",src:s(5251).A+"",width:"747",height:"498"})})]}),"\n",(0,n.jsxs)(l,{children:[(0,n.jsx)("summary",{children:"Plan #2"}),(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"img.png",src:s(42).A+"",width:"713",height:"523"})})]}),"\n",(0,n.jsxs)(l,{children:[(0,n.jsx)("summary",{children:"Index is scattered over many pages"}),(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"img.png",src:s(6917).A+"",width:"719",height:"511"})})]}),"\n",(0,n.jsx)(i.h2,{id:"reference",children:"Reference"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:s(990).A+"",children:"Download PDF"})})]})}function g(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(m,{...e})}):m(e)}},990:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/files/lec10-06460e4e3fe0e2313613582ee30ecbfe.pdf"},9024:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/img-efc76df2dd13d4ebb4ccf00eee92c981.png"},2784:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/img2-74509fd3818f1be9a2ed672bd8b2fbc1.png"},5251:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/img_2-5401bf7c76323b474b0367859f0dcead.png"},42:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/img_3-2c1ecee6374378799e008ade3556392f.png"},6917:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/img_4-0c531ee1b58793d0d66b0b1929de8964.png"}}]);